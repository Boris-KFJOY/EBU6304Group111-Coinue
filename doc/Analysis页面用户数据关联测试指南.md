# Analysis页面用户数据关联功能测试指南

## 功能概述

Analysis页面现已实现用户数据关联功能，用户的分析数据将自动保存到个人目录中，并在下次登录时自动加载。本指南将指导您如何测试这些新功能。

## 测试准备

### 1. 确保项目运行正常
```bash
cd /Users/boriskfjoy/Project/EBU6304Group111-Coinue
mvn clean compile
mvn javafx:run
```

### 2. 准备测试数据
- 使用项目根目录下的 `test_expense_data.csv` 文件
- 或创建您自己的CSV文件，格式如下：
```csv
项目,金额,类别,公司,时间
KFC午餐,45.50,食品,支付宝,2024-01-15
地铁费用,6.00,交通,微信支付,2024-01-15
...
```

## 测试场景

### 场景1：未登录用户测试

**目标**: 验证未登录状态下的分析功能

**步骤**:
1. 启动应用程序
2. 直接进入Analysis页面（如果可以）
3. 尝试导入CSV文件
4. 观察页面显示和提示信息

**预期结果**:
- 页面显示"请先登录以保存和加载个人分析数据"
- 用户状态标签显示"状态: 未登录"（红色）
- 导入CSV后显示"CSV文件已导入，但未保存（请登录以保存数据）"
- 数据能正常显示在图表中，但不会保存

### 场景2：已登录用户首次使用

**目标**: 验证新用户的数据关联功能

**步骤**:
1. 注册一个新用户（例如：username="TestUser1"）
2. 登录成功后进入Analysis页面
3. 观察初始状态
4. 导入test_expense_data.csv文件
5. 设置预算（例如：2000元）
6. 观察数据保存提示

**预期结果**:
- 页面显示"欢迎 TestUser1，请导入CSV文件开始分析"
- 用户状态标签显示"当前用户: TestUser1"（绿色）
- 导入成功后显示"CSV文件已导入并保存到您的个人数据中"
- 预算设置后显示"预算金额已保存到您的个人数据中"
- 在`data/users/TestUser1/`目录下生成相关文件

### 场景3：已登录用户数据持久化测试

**目标**: 验证用户数据的自动加载功能

**步骤**:
1. 使用场景2中的TestUser1账户
2. 登录后进入Analysis页面
3. 观察数据自动加载情况
4. 退出到其他页面再返回Analysis页面
5. 注销登录，再重新登录

**预期结果**:
- 页面自动显示"已加载用户历史数据 - TestUser1"
- 之前的图表、统计数据、预算设置自动恢复
- 页面切换时数据保持一致
- 重新登录后数据完整恢复

### 场景4：多用户数据隔离测试

**目标**: 验证不同用户的数据相互独立

**步骤**:
1. 创建第二个测试用户（username="TestUser2"）
2. 登录TestUser2，导入不同的CSV数据
3. 切换回TestUser1登录
4. 对比两个用户的数据

**预期结果**:
- TestUser2看到的是全新的界面
- TestUser1的数据完整保留
- 两用户数据完全独立，互不影响

### 场景5：数据管理功能测试

**目标**: 验证清除和刷新功能

**步骤**:
1. 登录有数据的用户
2. 点击"清除数据"按钮
3. 确认清除操作
4. 点击"刷新数据"按钮
5. 重新导入数据

**预期结果**:
- 清除数据时显示确认对话框
- 清除后页面恢复初始状态
- 刷新功能能重新加载用户数据
- 所有操作都有相应的成功/失败提示

### 场景6：CSV文件备份功能测试

**目标**: 验证CSV文件自动备份功能

**步骤**:
1. 登录用户并导入CSV文件
2. 检查用户目录中的文件备份

**预期结果**:
- 在`data/users/{username}/imported_csv_files/`目录下
- 找到带时间戳的CSV备份文件
- 文件格式: `yyyyMMdd_HHmmss_原文件名.csv`

## 目录结构验证

成功测试后，应生成以下目录结构：

```
data/
├── users.json                              # 全局用户信息
└── users/
    ├── TestUser1/
    │   ├── analysis_data.json              # 用户1的分析数据
    │   └── imported_csv_files/             # CSV备份目录
    │       └── 20241231_143022_test_expense_data.csv
    └── TestUser2/
        ├── analysis_data.json              # 用户2的分析数据
        └── imported_csv_files/
            └── 20241231_143156_another_data.csv
```

## 常见问题排查

### 1. 数据未保存
- 检查用户是否已登录
- 确认`data/users/`目录权限
- 查看控制台错误信息

### 2. 页面显示异常
- 确认所有FXML元素都已正确绑定
- 检查CSS样式文件
- 验证JavaFX版本兼容性

### 3. CSV导入失败
- 确认CSV文件格式正确
- 检查文件编码（建议UTF-8）
- 验证CSVHandler类功能

### 4. 用户切换问题
- 确认User.getCurrentUser()返回正确
- 检查会话管理逻辑
- 验证页面初始化顺序

## 性能测试建议

1. **大文件测试**: 测试导入包含1000+条记录的CSV文件
2. **频繁操作测试**: 连续导入多个文件，观察内存使用
3. **并发测试**: 快速切换用户和页面
4. **长时间运行**: 应用运行数小时后的稳定性

## 测试完成检查清单

- [ ] 未登录状态功能正常
- [ ] 新用户首次使用体验良好
- [ ] 数据自动加载功能正常
- [ ] 多用户数据完全隔离
- [ ] 清除和刷新功能正常
- [ ] CSV文件自动备份
- [ ] 目录结构正确生成
- [ ] 错误处理机制完善
- [ ] 用户界面友好
- [ ] 性能表现良好

## 注意事项

1. 测试过程中注意观察控制台输出，记录任何错误信息
2. 测试完成后建议清理测试数据：删除`data/users/TestUser*`目录
3. 如发现问题，请详细记录复现步骤和错误信息
4. 建议在不同操作系统上测试以确保兼容性

---

**测试完成后，Analysis页面将具备完整的用户数据关联功能，用户体验将显著提升！** 